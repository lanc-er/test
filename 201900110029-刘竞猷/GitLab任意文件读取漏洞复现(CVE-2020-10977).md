# GitLab任意文件读取漏洞复现(CVE-2020-10977)

GitLab
GitLab是一个利用 Ruby on Rails 开发的开源应用程序，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。它拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。

简单来说，GitLab就是一个与github差不多的项目管理和代码托管平台

官网：https://docs.gitlab.com/

GitLab与github的区别

itHub 和  GitLab 都是基于 web 的 Git 仓库，使用起来二者差不多，它们都提供了分享开源项目的平台，为开发团队提供了存储、分享、发布和合作开发项目的中心化云存储的场所。GitHub 作为开源代码库，拥有超过 900 万的开发者用户，目前仍然是最火的开源项目托管平台，GitHub 同时提供公共仓库和私有仓库，但如果使用私有仓库，是需要付费的。

GitLab 特色

(1) 允许免费设置仓库权限；

(2) 允许用户选择分享一个 project 的部分代码；

(3) 允许用户设置 project 的获取权限，进一步提升安全性；

(4) 可以设置获取到团队整体的改进进度；

(5) 通过 innersourcing 让不在权限范围内的人访问不到该资源；

所以，从代码的私有性上来看，GitLab 是一个更好的选择。但是对于开源项目而言，GitHub 依然是代码托管的首选。

 

漏洞介绍
在Gitlab 8.5-12.9版本中，存在一处任意文件读取漏洞，攻击者可以利用该漏洞，在不需要特权的状态下，读取任意文件，造成严重信息泄露，从而导致进一步被攻击的风险。

影响版本：

GitLab GitLab CE/EE >=8.5 and <=12.9  （CE社区版，EE企业版（收费））
GitLab GitLab CE >=8.5，<=12.9
漏洞复现
环境搭建

使用docker-compose.yml搭建漏洞环境，内容如下

环境：ubuntu(虚拟机的内存一定要大于1G，最好2G，不然环境可能起不来

版本：Gitlab 社区版本11.1.4
![image-20211024192139245](C:\Users\liu\AppData\Roaming\Typora\typora-user-images\image-20211024192139245.png)

然后访问8090，先注册一个用户xcc:12345678，然后才可以查看版本信息，如再后面加上/help

![img](https://img-blog.csdnimg.cn/20210114101413221.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70)

注册完账户就进入了首页，如下，环境到这里准备成功了

![img](https://img-blog.csdnimg.cn/20210114102858382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70)

漏洞复现

\1. 在当前页面点击创建项目，先创建两个项目，test1和test2，创建完test1后再回到首页同样的方式创建test2

![img](https://img-blog.csdnimg.cn/20210114103026834.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70)

\2. payload准备

点击test1——议题——列表——new issue——编写

插入如下payload

![image-20211024192905871](C:\Users\liu\AppData\Roaming\Typora\typora-user-images\image-20211024192905871.png)

title为payload，点击提交

![img](https://img-blog.csdnimg.cn/20210114103434267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70)

\3. 点击提交后自动进行了一个跳转，接着在当前页面右下角点击——移动议题——选择test2——移动

![img](https://img-blog.csdnimg.cn/20210114103553598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70)

\4. 点击移动后页面进行了刷新，在当前页面有个passwd，点击，立刻进行了下载，然后我们可以打开进行查看

![img](https://img-blog.csdnimg.cn/20210114103804653.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70)

查看passwd文件

![img](https://img-blog.csdnimg.cn/2021011410390422.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70)

修复建议
升级至最新版本

 

漏洞检测POC
实验环境版本：Gitlab社区办11.1.4

因为具体版本不同所以一些细节也会不同，不同版本脚本可能利用不成功

参考的大佬的脚本：https://github.com/thewhiteh4t/cve-2020-10977 ，其实验环版本为12.8.1，在11.1.4的版本中执行不成功，所以我修改了一下脚本

poc.py

用法：python poc url  登录的用户名 登录的密码
![img](https://img-blog.csdnimg.cn/20210115102446477.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70)

